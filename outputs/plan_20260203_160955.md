```json
{
  "plan_id": "GF_GOALFLOW_20250516_001_DI",
  "created_at": "2025-05-16T00:00:00Z",
  "meta": {
    "focus": "GoalFlow: 基于目标点引导和流匹配的多模态轨迹生成端到端自动驾驶方法",
    "mode": "Deep_Internalization",
    "paper_source": "GoalFlow: Goal-Driven Flow Matching for Multimodal Trajectories Generation in End-to-End Autonomous Driving",
    "code_source": "待用户提供（若适用）",
    "priority": 1
  },
  "context": {
    "atlas_snapshot": {
      "total_atoms": 0,
      "domain_coverage": ["e2e_ad", "trajectory_prediction", "generative_models"],
      "recent_contributions": [],
      "note": "首次分析GoalFlow论文，假定知识库为空。计划包含对现有资产的预查重步骤。"
    },
    "pre_check_result": {
      "paper_accessible": true,
      "code_repo_cloned": false,
      "domain_overlap": 0.0,
      "risk_assessment": "medium（核心依赖于论文中的公式和实验描述，若无源码则代码组件原子化深度受限）"
    }
  },
  "task_graph": {
    "stages": [
      {
        "stage_id": "S0",
        "stage_name": "系统握手与资产预检",
        "execution_mode": "sequential",
        "tasks": [
          {
            "task_id": "TASK_KV_PRECHECK_001",
            "agent": "Knowledge_Vault",
            "input_spec": {
              "sources": [
                {
                  "type": "system_memory",
                  "path": "/manifests/algorithm_atlas.md"
                }
              ],
              "query": "检索知识库 /atoms/ 目录下所有与以下主题相关的原子资产：1. 多模态轨迹生成（Multimodal Trajectory Generation）；2. 流匹配（Flow Matching）/ 扩散模型（Diffusion Models）在轨迹预测中的应用；3. 目标点引导（Goal Conditioning）或目标导向规划（Goal-Oriented Planning）。"
            },
            "output_spec": {
              "atom_type": "Precheck_Report",
              "quality_threshold": "C",
              "expected_count": "1",
              "format": "包含‘相似资产列表’、‘Delta分析建议’的简要报告"
            },
            "timeout_seconds": 300,
            "priority": 1,
            "description": "执行预查重，确定本次研读的增量价值点，避免重复劳动。"
          }
        ]
      },
      {
        "stage_id": "S1",
        "stage_name": "数学核心与算法原理内化",
        "execution_mode": "sequential",
        "depends_on": ["S0"],
        "tasks": [
          {
            "task_id": "TASK_SCHOLAR_MATH_001",
            "agent": "Scholar_Internalizer",
            "input_spec": {
              "sources": [
                {
                  "type": "paper",
                  "paper_id": "GoalFlow",
                  "focus_sections": ["3. Method（全文核心）", "3.1. Preliminary（流匹配基础）"]
                }
              ],
              "instructions": "请基于论文Section 3，深入分析并物理化以下核心数学模型：1. **Goal Point Construction & Scoring Mechanism**：目标点候选如何生成？评分函数 S(g, F_bev) 的数学形式是什么？它是如何融合BEV特征F_bev的？（请锚定公式、图表、页码）。2. **Flow Matching for Trajectory Generation**：条件流匹配（Conditional Flow Matching）在本工作中是如何定义的？轨迹的“概率路径” φ_t(x) 和“向量场” u_t(φ_t(x) | g, F_bev) 的具体形式是什么？（对比Eq. 3与论文中的实现）。3. **从Goal到Full Trajectory的映射**：模型 p(x | g, F_bev) 是如何通过学习到的向量场 u_t 进行采样的？分析其与标准扩散模型在约束轨迹发散方面的优势。"
            },
            "output_spec": {
              "atom_type": "Math_Atom",
              "quality_threshold": "A",
              "expected_count": "3-4",
              "format": "每个原子必须包含：原子名（如MATH_GOAL_SCORE_01）、物理含义、数学表达式（含引用锚点：如Eq. 5, Pg. 7）、与传统规控（如cost function）的映射思考。"
            },
            "timeout_seconds": 900,
            "priority": 1,
            "description": "内化学术核心，产出可复用的数学算子资产。"
          }
        ]
      },
      {
        "stage_id": "S2",
        "stage_name": "代码实现与工程细节剖析",
        "execution_mode": "parallel",
        "depends_on": ["S0"],
        "tasks": [
          {
            "task_id": "TASK_CODE_IMPL_001",
            "agent": "Code_Architect",
            "input_spec": {
              "sources": [
                {
                  "type": "paper",
                  "paper_id": "GoalFlow",
                  "focus_sections": ["3. Method", "4.4. Model Setups and Parameters"]
                }
              ],
              "instructions": "1. **架构还原**：根据论文描述，绘制GoalFlow的完整模型架构图（BEV编码器、Goal评分器、轨迹流匹配生成器）。2. **关键模块逻辑**：在没有源码的情况下，根据论文推导关键模块的**伪代码实现**：a) 目标点候选采样逻辑；b) 评分网络的前向过程；c) 条件流匹配模型（轨迹生成器）的训练损失计算（如Eq. 4）和推理采样循环。3. **参数与配置**：从实验章节提取关键超参数（如目标点数量K、轨迹长度T、流匹配的噪声调度等），并评估其工程选择。**重要**：所有推断必须明确标注依据（如‘据第5页描述’），并指出不确定处。"
            },
            "output_spec": {
              "atom_type": "Code_Atom",
              "quality_threshold": "B",
              "expected_count": "2-3",
              "format": "原子需包含：原子名（如CODE_GOAL_SCORER_01）、功能描述、伪代码/接口定义（含注释）、论文依据、潜在的TensorRT/部署优化思考点（如评分网络的轻量化）。"
            },
            "timeout_seconds": 750,
            "priority": 1,
            "description": "在无源码情况下，最大限度地从论文中还原工程实现细节，形成可讨论的设计资产。"
          }
        ]
      },
      {
        "stage_id": "S3",
        "stage_name": "场景验证与实验洞察挖掘",
        "execution_mode": "sequential",
        "depends_on": ["S1", "S2"],
        "tasks": [
          {
            "task_id": "TASK_VALIDATOR_EXP_001",
            "agent": "Validator_Scenarist",
            "input_spec": {
              "sources": [
                {
                  "type": "paper",
                  "paper_id": "GoalFlow",
                  "focus_sections": ["4. Experiments", "4.5. Results and Analysis", "图/表"]
                }
              ],
              "instructions": "请深度分析实验部分，产出场景与验证资产：1. **失效模式与Corner Case分析**：根据论文对比实验（如与纯扩散模型对比），总结GoalFlow主要解决了哪些类型的轨迹生成失败问题（例如：轨迹过度发散、与场景物理冲突、模态混淆）？将其转化为具体的**场景判据**。2. **指标深度解读**：对MinADE， MinFDE， Miss Rate， mAP等指标在该任务中的具体含义及其反映的模型能力进行解读。3. **消融实验洞察**：分析关于Goal Scoring和Flow Matching的消融实验，量化每个组件对最终性能的贡献度，并思考在量产中的模块化应用可能。"
            },
            "output_spec": {
              "atom_type": "Scenario_Atom",
              "quality_threshold": "B+",
              "expected_count": "3-5",
              "format": "原子需包含：原子名（如SCENARIO_GOALFLOW_DIVERGENCE_01）、场景描述（何时何地）、失效现象、GoalFlow的解决机理、关联的数学/代码原子名。"
            },
            "timeout_seconds": 600,
            "priority": 1,
            "description": "将论文实验结论转化为可验证的场景和评估标准，连接算法原理与实际效果。"
          }
        ]
      },
      {
        "stage_id": "S4",
        "stage_name": "资产整合与战略决策",
        "execution_mode": "sequential",
        "depends_on": ["S1", "S2", "S3"],
        "tasks": [
          {
            "task_id": "TASK_VAULT_INTEGRATE_001",
            "agent": "Knowledge_Vault",
            "input_spec": {
              "sources": [
                {
                  "type": "task_output",
                  "task_ids": ["TASK_SCHOLAR_MATH_001", "TASK_CODE_IMPL_001", "TASK_VALIDATOR_EXP_001"]
                }
              ],
              "instructions": "请整合本轮研读产出的所有原子资产，执行：1. **资产入库**：将Math_Atom, Code_Atom, Scenario_Atom分别存入`/atoms/math_ops/`, `/atoms/code_snippets/`, `/atoms/scenarios/`目录下，文件命名需规范（如`math_goalflow_scoring_20250516.md`）。2. **知识图谱更新**：在`/manifests/algorithm_atlas.md`中新增‘多模态轨迹生成’或‘端到端规划’分支，记录GoalFlow的核心思想、优势、及本次产出的原子资产链接。3. **生成本次研读的整合摘要报告**。"
            },
            "output_spec": {
              "atom_type": "Integration_Report",
              "quality_threshold": "B",
              "expected_count": "1",
              "format": "包含资产入库清单、Atlas更新内容摘要的报告。"
            },
            "timeout_seconds": 600,
            "priority": 1,
            "description": "完成资产闭环，确保新知识被持久化、结构化存储。"
          },
          {
            "task_id": "TASK_CRITIC_ASSESS_001",
            "agent": "Strategic_Critic",
            "input_spec": {
              "sources": [
                {
                  "type": "paper",
                  "paper_id": "GoalFlow",
                  "focus_sections": ["全文，尤5. Conclusion与4.5"]
                },
                {
                  "type": "task_output",
                  "task_ids": ["TASK_VAULT_INTEGRATE_001"]
                }
              ],
              "instructions": "请从量产研发视角对GoalFlow方法进行终极审计：1. **创新价值评估**：目标点引导的流匹配范式，相比传统采样-聚类或扩散模型，在**确定性、效率、安全性**上带来了哪些可量化的提升？2. **工程化风险**：指出该方法在实时性（推理延迟）、模块依赖性（对上游感知BEV特征质量的敏感性）、复杂交互场景处理等方面的潜在风险。3. **复利路径建议**：提出1-2个最值得从GoalFlow中剥离、并在其他规划模块中尝试复用的核心思想或组件。"
            },
            "output_spec": {
              "atom_type": "Strategic_Atom",
              "quality_threshold": "A-",
              "expected_count": "1",
              "format": "原子需包含：审计结论（[Go/Watch/Skip]建议及理由）、风险清单、高价值复用点推荐。"
            },
            "timeout_seconds": 600,
            "priority": 1,
            "description": "给出是否跟进以及如何跟进该技术的最终战略决策。"
          }
        ]
      }
    ]
  },
  "quality_gates": {
    "pre_execution": [
      {
        "gate_id": "QG_PRE_ACCESS_01",
        "gate_type": "pre_execution",
        "task_id": "TASK_SCHOLAR_MATH_001",
        "checks": [
          {
            "check_id": "CHECK_PAPER_ACCESS",
            "check_type": "source_accessibility",
            "target": "paper_source",
            "condition": "user_has_provided_full_paper == true",
            "error_code": "E001",
            "severity": "critical",
            "message": "深度内化模式必须基于完整论文。请确认论文全文已可访问。"
          }
        ],
        "failure_action": "block"
      }
    ],
    "post_execution": [
      {
        "gate_id": "QG_POST_SCHOLAR_01",
        "gate_type": "post_execution",
        "task_id": "TASK_SCHOLAR_MATH_001",
        "checks": [
          {
            "check_id": "CHECK_REF_ANCHOR",
            "check_type": "output_validation",
            "target": "Math_Atom",
            "condition": "all_atoms_contain_valid_citation_anchors == true",
            "error_code": "E101",
            "severity": "critical",
            "message": "Scholar产出的数学原子必须全部包含对论文公式、页码的明确引用锚定，禁止无源推导。"
          }
        ],
        "failure_action": "retry"
      }
    ],
    "final_integration": [
      {
        "gate_id": "QG_FINAL_DECISION_01",
        "gate_type": "final_integration",
        "task_id": "TASK_CRITIC_ASSESS_001",
        "checks": [
          {
            "check_id": "CHECK_DECISION_CLARITY",
            "check_type": "output_validation",
            "target": "Strategic_Atom",
            "condition": "output_contains_clear_go_watch_skip_recommendation == true",
            "error_code": "E201",
            "severity": "high",
            "message": "战略审计原子必须包含明确的[Go/Watch/Skip]建议及逻辑支撑。"
          }
        ],
        "failure_action": "block"
      }
    ]
  },
  "error_handling": {
    "retry_policy": {
      "max_attempts": 2,
      "backoff_strategy": "linear",
      "base_delay_seconds": 10
    },
    "fallback_strategies": {
      "on_quality_failure": {
        "action": "degrade_and_log",
        "new_threshold": "C",
        "log_message": "因[具体原因]质量门未通过，降级至阈值C接受产出，但需在报告中显著标注质量问题。"
      },
      "on_code_unavailable": {
        "action": "focus_on_paper",
        "task_id": "TASK_CODE_IMPL_001",
        "message":