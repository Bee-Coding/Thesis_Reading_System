```json
{
  "plan_id": "GoalFlow_Deep_Internalization_20250203_001",
  "created_at": "2025-02-03T00:00:00Z",
  "meta": {
    "focus": "GoalFlow: 一种通过目标点约束和流匹配生成高质量、多模态轨迹的端到端自动驾驶方法。核心关注其目标点构建、流匹配生成与轨迹选择机制，旨在内化为可复用的轨迹生成与规划组件。",
    "mode": "Deep_Internalization",
    "paper_source": "GoalFlow: Goal-Driven Flow Matching for Multimodal Trajectories Generation in End-to-End Autonomous Driving",
    "code_source": "需用户提供（若存在）。任务执行中将首先尝试检索公开代码库。",
    "priority": 1,
    "estimated_duration_minutes": 45
  },
  "context": {
    "atlas_snapshot": {
      "total_atoms": "需从 /manifests/algorithm_atlas.md 加载后更新",
      "domain_coverage": ["planning", "trajectory_generation", "diffusion_models", "flow_matching"],
      "recent_contributions": ["需检索后填充，重点关注多模态轨迹生成、扩散模型、流匹配相关原子"]
    },
    "pre_check_result": {
      "paper_accessible": true,
      "code_repo_cloned": "待确认",
      "domain_overlap": "待评估",
      "risk_assessment": "中低风险。论文方法描述详实，但若无开源代码，工程复现部分将受限。"
    }
  },
  "task_graph": {
    "stages": [
      {
        "stage_id": "S1",
        "stage_name": "知识库预热与Delta审计",
        "execution_mode": "sequential",
        "tasks": [
          {
            "task_id": "TASK_VAULT_PREFLIGHT",
            "agent": "Knowledge_Vault",
            "input_spec": {
              "sources": [],
              "instructions": "1. 加载 /manifests/algorithm_atlas.md，获取当前知识库状态。2. 检索 /atoms/ 目录下与‘多模态轨迹生成’、‘扩散模型(Diffusion)’、‘流匹配(Flow Matching)’、‘目标点规划’相关的现有原子资产。3. 基于现有资产，预评估本论文GoalFlow方法的潜在创新点（Delta），并在报告中明确指出哪些是已知概念，哪些是待分析的新增量。"
            },
            "output_spec": {
              "atom_type": "Report_Atom",
              "quality_threshold": "B",
              "expected_count": 1,
              "deliverable_path": "/reports/2025-02/2025-02-03/00_preflight_report.md"
            },
            "timeout_seconds": 300,
            "priority": 1
          }
        ]
      },
      {
        "stage_id": "S2",
        "stage_name": "核心原理并行内化",
        "execution_mode": "parallel",
        "tasks": [
          {
            "task_id": "TASK_SCHOLAR_METHOD",
            "agent": "Scholar_Internalizer",
            "input_spec": {
              "sources": [
                {
                  "type": "paper",
                  "paper_id": "GoalFlow",
                  "focus_sections": ["3. Method (全文)", "3.1. Preliminary"]
                }
              ],
              "instructions": "深度解构GoalFlow的数学模型。1. **目标点构建与评分机制**：解析从场景信息（如BEV特征）生成候选目标点，并对其进行评分的具体公式、网络结构及损失函数（论文中Figure 2, Eq. ?）。2. **流匹配轨迹生成**：解释如何以目标点为条件，通过流匹配(Flow Matching)生成轨迹。推导或说明其条件向量场、概率路径的定义及对应的训练目标（与Eq. 4, 5, 6等对应）。3. **整体架构与训练流程**：厘清目标点模型与轨迹生成模型是如何联合训练或分步训练的。产出强调物理意义与现有规控（如Lattice Planner）的映射关系。"
            },
            "output_spec": {
              "atom_type": "Math_Atom",
              "quality_threshold": "A",
              "expected_count": "3-5",
              "naming_convention": "MATH_GOALFLOW_[TOPIC]_01"
            },
            "timeout_seconds": 900,
            "priority": 1
          },
          {
            "task_id": "TASK_CODE_ARCHITECTURE",
            "agent": "Code_Archaeologist",
            "input_spec": {
              "sources": [
                {
                  "type": "paper",
                  "paper_id": "GoalFlow",
                  "focus_sections": ["3. Method", "4.4. ModelSetupsandParameters"]
                }
              ],
              "instructions": "1. **首要指令**：尝试在GitHub等公开平台搜索标题为‘GoalFlow’的代码仓库。若找到，则进行下一步；若未找到，立即报告并等待进一步指令。2. **架构复原**：基于论文描述，复原核心模块的代码级设计。包括：目标点预测网络（输入BEV特征，输出K个候选目标点及分数）的潜在PyTorch/TensorFlow类结构；流匹配模型（以目标点和BEV为条件）的采样与训练循环伪代码。3. **关键实现细节**：提取网络维度、关键超参（如K值、轨迹点N、时间步数）、使用的具体损失函数。所有描述必须严格引用论文章节或图表。"
            },
            "output_spec": {
              "atom_type": "Code_Atom",
              "quality_threshold": "B+",
              "expected_count": "2-3",
              "naming_convention": "CODE_GOALFLOW_[MODULE]_01"
            },
            "timeout_seconds": 600,
            "priority": 1,
            "dependencies": ["TASK_VAULT_PREFLIGHT"]
          }
        ]
      },
      {
        "stage_id": "S3",
        "stage_name": "实验验证与场景分析",
        "execution_mode": "sequential",
        "tasks": [
          {
            "task_id": "TASK_VALIDATOR_EXPERIMENT",
            "agent": "Empirical_Validator",
            "input_spec": {
              "sources": [
                {
                  "type": "paper",
                  "paper_id": "GoalFlow",
                  "focus_sections": ["4. Experiments", "4.2. Metrics", "4.5. ResultsandAnalysis"]
                }
              ],
              "instructions": "1. **定量分析**：提取GoalFlow在nuScenes等数据集上的关键性能指标（minADE, minFDE, MR, Multi-modality相关指标），并与基线（如UniAD, Diffuser, …）进行对比。制成清晰的对比表格。2. **定性分析**：分析论文中的可视化结果（如轨迹多样性与场景贴合度），解释目标点引导如何解决轨迹发散问题。3. **失效模式与边界推测**：基于实验分析，推测该方法在哪些极端场景（如极度拥挤、目标点模糊）下可能失效，形成初步的场景判据假设。"
            },
            "output_spec": {
              "atom_type": ["Report_Atom", "Scenario_Atom"],
              "quality_threshold": "B+",
              "expected_count": "1份报告 + 1-2个场景判据",
              "naming_convention": "SCENARIO_GOALFLOW_FAILURE_01"
            },
            "timeout_seconds": 600,
            "priority": 1,
            "dependencies": ["TASK_SCHOLAR_METHOD"]
          }
        ]
      },
      {
        "stage_id": "S4",
        "stage_name": "量产评估与资产闭环",
        "execution_mode": "parallel",
        "tasks": [
          {
            "task_id": "TASK_CRITIC_ASSESSMENT",
            "agent": "Strategic_Critic",
            "input_spec": {
              "sources": [
                {
                  "type": "report",
                  "reference": "TASK_SCHOLAR_METHOD, TASK_CODE_ARCHITECTURE, TASK_VALIDATOR_EXPERIMENT 的产出摘要"
                }
              ],
              "instructions": "基于所有分析成果，进行量产化审计：1. **计算需求**：评估流匹配模型相比扩散模型在推理速度上的潜在优势/劣势。2. **系统集成**：分析将GoalFlow作为轨迹提议模块，集成到现有感知-预测-规划流水线中的接口与数据流挑战。3. **确定性风险**：评估从‘多模态轨迹生成’到‘最终轨迹选择’这一过程的确定性是否满足车规要求。4. **给出明确的 [Go/Watch/Skip] 建议及理由**。"
            },
            "output_spec": {
              "atom_type": "Report_Atom",
              "quality_threshold": "A",
              "expected_count": 1,
              "deliverable_path": "/reports/2025-02/2025-02-03/04_critic_verdict.md"
            },
            "timeout_seconds": 300,
            "priority": 1,
            "dependencies": ["TASK_VALIDATOR_EXPERIMENT"]
          },
          {
            "task_id": "TASK_VAULT_INTEGRATION",
            "agent": "Knowledge_Vault",
            "input_spec": {
              "sources": [
                {
                  "type": "report",
                  "reference": "所有任务的最终产出"
                }
              ],
              "instructions": "执行资产归档与知识整合：1. **原子入库**：将本次会话产生的所有`Math_Atom`, `Code_Atom`, `Scenario_Atom`按照功能分类，存入`/atoms/`对应目录（如`/atoms/trajectory_generation/`）。2. **索引更新**：在`/manifests/paper_index.json`中注册本论文，并建立与其产出的原子资产的映射关系。3. **地图演进**：更新`/manifests/algorithm_atlas.md`，在‘轨迹生成’或‘端到端驾驶’章节中，添加GoalFlow方法的摘要、核心贡献（Delta）以及指向新原子的链接，记录本次复利增长。"
            },
            "output_spec": {
              "atom_type": "Report_Atom",
              "quality_threshold": "B",
              "expected_count": 1,
              "deliverable_path": "/reports/2025-02/2025-02-03/05_integration_report.md"
            },
            "timeout_seconds": 450,
            "priority": 1,
            "dependencies": ["TASK_SCHOLAR_METHOD", "TASK_CODE_ARCHITECTURE", "TASK_VALIDATOR_EXPERIMENT"]
          }
        ]
      }
    ]
  },
  "quality_gates": {
    "pre_execution": [
      {
        "gate_id": "QG_PRE_VAULT_01",
        "gate_type": "pre_execution",
        "task_id": "TASK_VAULT_PREFLIGHT",
        "checks": [
          {
            "check_id": "CHECK_ATLAS_EXISTS",
            "check_type": "file_existence",
            "target": "/manifests/algorithm_atlas.md",
            "condition": "file_exists == true",
            "error_code": "E_ATLAS_MISSING",
            "severity": "high",
            "error_message": "核心记忆文件algorithm_atlas.md缺失，无法建立跨会话记忆。"
          }
        ],
        "failure_action": "continue_with_warning"
      }
    ],
    "post_execution": [
      {
        "gate_id": "QG_POST_SCHOLAR_01",
        "gate_type": "post_execution",
        "task_id": "TASK_SCHOLAR_METHOD",
        "checks": [
          {
            "check_id": "CHECK_MATH_ANCHOR",
            "check_type": "content_validation",
            "target": "output.atoms",
            "condition": "所有Math_Atom均包含明确的论文公式引用（如Eq. X）或页码",
            "error_code": "E_HALLUCINATION_MATH",
            "severity": "critical",
            "error_message": "数学原子缺少原始论文锚定，存在幻觉风险。"
          }
        ],
        "failure_action": "retry"
      },
      {
        "gate_id": "QG_POST_CODE_01",
        "gate_type": "post_execution",
        "task_id": "TASK_CODE_ARCHITECTURE",
        "checks": [
          {
            "check_id": "CHECK_CODE_SOURCE_DECLARATION",
            "check_type": "content_validation",
            "target": "output.report",
            "condition": "报告明确声明是否找到开源代码库，若未找到，所有架构描述均标注为‘基于论文推测’",
            "error_code": "E_SOURCE_AMBIGUOUS",
            "severity": "high",
            "error_message": "代码分析未清晰说明信息源，可能混淆事实与推测。"
          }
        ],
        "failure_action": "block"
      }
    ],
    "final_integration": [
      {
        "gate_id": "QG_FINAL_ATOM_COUNT",
        "gate_type": "final_integration",
        "task_id": "TASK_VAULT_INTEGRATION",
        "checks": [
          {
            "check_id": "CHECK_ATOMS_GENERATED",
            "check_type": "count_validation",
            "target": "output.integration_summary.new_atoms_count",
            "condition": "new_atoms_count >= 3",
            "error_code": "E_LOW_YIELD",
            "severity": "medium",
            "error_message": "本次深度内化产出的原子资产数量未达预期。"
          }
        ],
        "failure_action": "continue_with_warning"
      }
    ]
  },
  "error_handling": {
    "retry_policy": {
      "max_attempts": 2,
      "backoff_strategy": "exponential",
      "base_delay_seconds": 10
    },
    "fallback_strategies": {
      "on_quality_failure": {
        "action": "degrade_and_annotate",
        "parameters": {
          "new_threshold": "C",
          "annotation": "【注意】此资产因原始文献信息不足或质量门检查未完全通过，可信度降级。"
        }
      },
      "on_code_not_found": {
        "action": "switch_to_paper_only_analysis",
        "parameters": {
          "task_id": "TASK_CODE_ARCHITECTURE",
          "new_instruction": "基于论文第3、4.4节及其他相关描述，尽最大努力进行模块化设计推测，并显著标记所有‘论文未明确、基于推理’的部分。重点转向接口定义与算法流程伪代码。"
        }
      }
    },
    "escalation_rules": [
      {
        "error_code_pattern": "E_HALLUCINATION_*",
        "severity": "critical",
        "action": "immediate_halt",
        "notification": "触发真实性红线，任务终止。需人工审查。"
      }
    ]
  },
  "expected_outputs": {
    "atoms": [
      {
        "type": "Math_Atom",
        "count": "3-5",
        "quality_target": "A-",
        "topics": ["目标点评分机制", "条件流匹配损失函数", "整体训练目标"]
      },
      {
        "type": "Code_Atom",
        "count": "2-3",
        "quality_target": "B+",
        "topics": ["目标点预测网络结构", "流匹配采样器"]
      },
      {
        "type": "Scenario_Atom",
        "count": "1-2",
        "quality_target